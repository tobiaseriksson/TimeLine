<html>  
    <head>  
        <title>Tobias TimeLine in JS with Raphael</title>  
        <script type="text/javascript" src="jquery-1.7.1.min.js"></script>       
        <script type="text/javascript" src="raphael-min.js"></script>  
        <script type="text/javascript">
        window.onload = function() { 
        	var width = 1000;
        	var height = 200;
        	var pixelsPerDay = 15;
        	var pixelsHeightDay = 3;
        	var pixelsHeightWeek = 6;
        	var pixelsHeightMonth = 9;
        	var yAxesPosition = height / 2;
        	var xStep = width / 2; // pixels left/right when clicking 
        	
		    var paper = new Raphael(document.getElementById('canvas_container'), width, height);  
			
			var currentXPosition = 0;
			var monthNames = [ 'Jan', 'Feb', 'Mar' ,'Apr', 'May' , 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ];
			var dates = new Array();
			dates[0] = "2011-10-02";
			dates[1] = "2011-10-09";
			dates[2] = "2011-10-12";
			dates[3] = "2011-10-13";
			dates[4] = "2011-10-17";
			dates[5] = "2011-10-20";
			dates[6] = "2012-02-10";
			
			var notes = new Array();
			notes[0] = "dag 0";
			notes[1] = "dag 1";
			notes[2] = "dag 2";
			notes[3] = "dag 3";
			notes[4] = "dag 4";
			notes[5] = "dag 5";
			notes[6] = "dag 6";
			
			// find limits start and end
			var startDate = Number.MAX_VALUE;
			var endDate = Number.MIN_VALUE;
			
			for( var i = 0; i < dates.length; i++ ) {
				var d = dates[i].split('-');
				var tmpDate = new Date(0);
				tmpDate.setFullYear( d[0] );
				tmpDate.setMonth( d[1]-1 );
				tmpDate.setDate( d[2] );
				var t  = tmpDate.getTime();
				if( t > endDate ) endDate = t;
				if( t < startDate ) startDate = t;
			}
			
			// allways start on a Monday
			var tmpDate = new Date( startDate );
			if( tmpDate.getDay() == 0 ) {
				startDate = startDate - (1000*3600*24*6); // minus 6 days
			} else {
				startDate = startDate - (1000*3600*24*(tmpDate.getDay()-1)); // minus n days
			}
			endDate = endDate + (1000*3600*24*7); // plus 7 days
				
			var totalDays = (endDate - startDate) / (1000*3600*24);
			
			// console.log( "days="+totalDays );
			 $("body").append( "days="+totalDays );
			 
			var timeline = paper.set();
			var x1 = 0;
			var xMax = totalDays * pixelsPerDay;
			var x = x1;
			var currentDay = startDate;
			var path = "M"+x1+" "+yAxesPosition+"L"+xMax+" "+yAxesPosition;
			while( x <= xMax ) {    
		    	// always set a marker per day
		    	path = path.concat( "M", x, " ", yAxesPosition-pixelsHeightDay, "L", x, " ", yAxesPosition+pixelsHeightDay );
		    	var tmpDate = new Date( currentDay );
		    	// set a DATE number every Monday
		    	if( tmpDate.getDay() == 1 ) {
		    		path = path.concat( "M", x, " ", yAxesPosition-pixelsHeightWeek, "L", x, " ", yAxesPosition+pixelsHeightWeek );
		    		var dayString = ''+tmpDate.getDate();
		    		timeline.push( paper.text( x, yAxesPosition+pixelsHeightWeek*2, dayString ) );
		    	}
		    	// set a MONTH name every 1;st in the month
		    	if( tmpDate.getDate() == 1 ) {
		    		path = path.concat( "M", x, " ", yAxesPosition-pixelsHeightMonth, "L", x, " ", yAxesPosition+pixelsHeightMonth );
		    		var monthString = ''+monthNames[ tmpDate.getMonth() ];
		    		timeline.push( paper.text( x, yAxesPosition-pixelsHeightMonth*2, monthString ) );
		    		if( tmpDate.getMonth() == 0 ) {
		    			var yearString = ''+tmpDate.getFullYear();
			    		timeline.push( paper.text( x, yAxesPosition-pixelsHeightMonth*3, yearString ) );
			    	}
		    	}
		    	x = x + pixelsPerDay;
		    	currentDay = currentDay + (1000*3600*24);
		    }
		    var timelineLine = paper.path( path );
			timelineLine.attr({stroke: '#f00', 'stroke-width': 1});  
			timeline.push( timelineLine );
			
			// position the notes at the dates
			var textPositionOffsets = [ 0.5 * height / 2 , -0.5 * height / 2, 0.75 * height / 2, -0.75 * height / 2 ];
			var textOffsetIndex = 0;
			path="";
			var over = true;
			for( var i = 0; i < dates.length; i++ ) {
				var d = dates[i].split('-');
				var tmpDate = new Date(0);
				tmpDate.setFullYear( d[0] );
				tmpDate.setMonth( d[1]-1 );
				tmpDate.setDate( d[2] );
				var t  = tmpDate.getTime();
				var days = (t - startDate) / (1000*3600*24);
				x = days * pixelsPerDay;
				var noteString = notes[i];
				 $("body").append( "<br>date : "+noteString );
				if( textOffsetIndex >= textPositionOffsets.length ) textOffsetIndex = 0;
				var textOffset = textPositionOffsets[ textOffsetIndex ];
				var yTextPosition = yAxesPosition + textOffset;
				var xTextPosition = x+((textOffset>0)?-textOffset:textOffset);
				textOffsetIndex++;
			    timeline.push( paper.text( xTextPosition, yTextPosition, noteString ) );
			    path = path.concat( "M", x, " ", yAxesPosition, "L", xTextPosition, " ", yTextPosition );
			}
			var notePaths = paper.path( path );
			notePaths.attr({stroke: '#f00', 'stroke-width': 1});  
			timeline.push( notePaths );
			
			
			var leftArrowPath = "M16,30.534c8.027,0,14.534-6.507,14.534-14.534c0-8.027-6.507-14.534-14.534-14.534C7.973,1.466,1.466,7.973,1.466,16C1.466,24.027,7.973,30.534,16,30.534zM18.335,6.276l3.536,3.538l-6.187,6.187l6.187,6.187l-3.536,3.537l-9.723-9.724L18.335,6.276z";
			var leftArrow = paper.path( leftArrowPath );
		    leftArrow.attr({ fill: "#ccc", stroke: "none" } );
		    var rightArrowPath = "M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466zM13.665,25.725l-3.536-3.539l6.187-6.187l-6.187-6.187l3.536-3.536l9.724,9.723L13.665,25.725z";
			var rightArrow = paper.path( rightArrowPath );
		    rightArrow.attr({ fill: "#ccc", stroke: "none" } );
		    rightArrow.transform( "t"+(width-32)+",0" );
			
		    leftArrow.click(function () {
		    	if( currentXPosition >=  xStep ) return;
		    	currentXPosition = currentXPosition + xStep;
		    	var t = "t"+currentXPosition+",0";
            	timeline.animate( { transform: t}, xStep, ">" );
            	$("body").append( "<br>t="+currentXPosition );
            });
            rightArrow.click(function () {
            	if( currentXPosition <= (2*xStep)-xMax ) return; 
		    	currentXPosition = currentXPosition - xStep;
		    	var t = "t"+currentXPosition+",0";
            	timeline.animate( { transform: t}, xStep, ">" );
            	 $("body").append( "<br>t="+currentXPosition );
            });            
		}  
        
        </script>  
        <style type="text/css">  
            #canvas_container {  
                width: 1000px;  
                height: 200px;
                border: 0px solid #aaa;  
            }  
        </style>  
    </head>  
    <body>  
        <div id="canvas_container"></div>  
        <br>
        <b>Log</b>
        <br>
    </body>  
</html>  
